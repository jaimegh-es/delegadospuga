---
import Layout from "../layouts/Layout.astro";
import HeroCarousel from "../components/Hero.astro";
import Navigation from "../components/Navigation.astro";
import LinksSection from "../components/LinksSection.astro";
import MoodleNotifierBanner from "../components/MoodleNotifierBanner.astro";
import NewsSection from "../components/NewsSection.astro";
import CountdownBanner from "../components/CountdownBanner.astro";
import Footer from "../components/Footer.astro";
import CalendarioExamenes from "../components/CalendarioExamenes.astro";
import Eventos from "../components/Eventos.astro";
import DisclaimerPopup from "../components/DisclaimerPopup.astro";
import LostHours from "../components/LostHours.astro";
import NotificationSettings from "../components/NotificationSettings.astro";
import AbsencesNotice from "../components/AbsencesNotice.astro";



import { db } from "../lib/firebase/server";
import { Timestamp } from "firebase-admin/firestore";

let todayCount = 0;
try {
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    const tomorrow = new Date(today);
    tomorrow.setDate(tomorrow.getDate() + 1);

    const snapshot = await db.collection("absences")
        .where("date", ">=", Timestamp.fromDate(today))
        .where("date", "<", Timestamp.fromDate(tomorrow))
        .get();
    todayCount = snapshot.size;
} catch (e) {
    console.error("Error fetching today absences", e);
}
---

<Layout>
	<Navigation />
	<!-- <CountdownBanner /> -->
	<HeroCarousel />

	<!-- <MoodleNotifierBanner /> -->
	<LinksSection />
	<AbsencesNotice todayCount={todayCount} />
	<NewsSection />

	<CalendarioExamenes />

	<Eventos />
	<!-- 	 <LostHours /> -->
	<Footer />
	<DisclaimerPopup />
	<NotificationSettings />

	<script>
		import "../scripts/main.js";
	</script>
</Layout>
