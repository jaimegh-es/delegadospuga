---
import NewsCard from "./NewsCard.astro";
import { db } from "../lib/firebase/server";

let news = [];
try {
  const snapshot = await db.collection("news").orderBy("date", "desc").limit(6).get();
  news = snapshot.docs.map(doc => {
      const data = doc.data();
      return {
        id: doc.id,
        title: data.title,
        image: data.image,
        description: data.description,
        link: `/noticias/${doc.id}`,
        date: new Date(data.date).toLocaleDateString('es-ES', { day: 'numeric', month: 'short', year: 'numeric' })
      };
  });
} catch (error) {
  console.error("Error fetching news:", error);
}
---

<section class="news-section" id="noticias">
    <div class="container">
        <h2 class="section-title">Ãšltimas Noticias</h2>
        {news.length > 0 ? (
            <div class="news-grid">
                {news.map((item) => <NewsCard item={item} />)}
            </div>
        ) : (
            <p style="text-align: center; color: #64748b;">No hay noticias recientes.</p>
        )}
    </div>
</section>

<style>
    .news-section {
        padding: 80px 20px;
        background: #f8fafc;
    }

    .container {
        max-width: 1200px;
        margin: 0 auto;
    }

    .section-title {
        font-size: 2.5rem;
        font-weight: 700;
        color: #2000ad;
        text-align: center;
        margin-bottom: 48px;
    }

    .news-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 32px;
        padding: 0 16px;
    }

    @media (max-width: 768px) {
        .section-title {
            font-size: 2rem;
        }

        .news-section {
            padding: 60px 20px;
        }
    }
</style>
