---
import { teachersData } from '../data/teachers';
const teachers = [...new Set(teachersData.map(t => t.teacher))].sort();
---

<div class="card form-card">
    <h3><i class="fa-solid fa-triangle-exclamation text-yellow-500"></i> Reportar Incidencia</h3>
    <p class="text-sm text-gray-500 mb-4">Estas quejas son privadas y solo visibles por la administración.</p>
    
    <form id="complaint-form">
        <div class="form-group">
            <label>Tipo de Incidencia</label>
            <select name="type" required>
                <option value="disrespect">Falta de Respeto</option>
                <option value="general">Queja General</option>
            </select>
        </div>

        <div class="form-group">
            <label>Profesor Implicado (Opcional)</label>
            <select name="teacher">
                <option value="">-- Ninguno --</option>
                {teachers.map(t => <option value={t}>{t}</option>)}
            </select>
        </div>

        <div class="form-group">
            <label>Descripción</label>
            <textarea name="description" rows="4" required placeholder="Describe lo ocurrido..."></textarea>
        </div>

        <button type="submit" class="submit-btn">Enviar Reporte Privado</button>
    </form>
</div>

<style>
    .card {
        background: white;
        padding: 1.5rem;
        border-radius: 12px;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        border: 1px solid #f3f4f6;
    }
    
    h3 {
        font-weight: 700;
        margin-bottom: 0.5rem;
        color: #1f2937;
    }

    .form-group {
        margin-bottom: 1rem;
    }

    label {
        display: block;
        font-size: 0.85rem;
        font-weight: 600;
        color: #4b5563;
        margin-bottom: 0.25rem;
    }

    select, textarea {
        width: 100%;
        padding: 0.6rem;
        border: 1px solid #d1d5db;
        border-radius: 8px;
        font-size: 0.9rem;
    }

    .submit-btn {
        width: 100%;
        background: #f59e0b;
        color: white;
        padding: 0.75rem;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.2s;
    }
    .submit-btn:hover { background: #d97706; }
</style>

<script>
    const form = document.getElementById('complaint-form') as HTMLFormElement;
    form?.addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = new FormData(form);
        const data = Object.fromEntries(formData);
        
        try {
            const res = await fetch('/api/complaints', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });

            if(res.ok) {
                alert('Incidencia registrada correctamente (Privada).');
                form.reset();
            } else {
                alert('Error al enviar reporte.');
            }
        } catch(e) {
            alert('Error de conexión.');
        }
    });
</script>
